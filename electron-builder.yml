appId: com.mwangiiharun.accelara
productName: ACCELARA

directories:
  output: release
  buildResources: build
  app: .

files:
  - "dist/**"
  - "electron/**"
  - "package.json"
  - "!node_modules/**"
  - "!**/*.md"
  - "!**/test/**"
  - "!**/tests/**"

extraResources:
  - from: "bin"
    to: "bin"
    filter:
      - "api-wrapper*"
      - "clidm*"

asar: true
asarUnpack:
  - "bin/**"

mac:
  category: public.app-category.utilities
  icon: build/icon.icns
  artifactName: "ACCELARA-${arch}-${version}.${ext}"
  target:
    - dmg
  hardenedRuntime: false
  gatekeeperAssess: false
  entitlementsInherit: null
  notarize: false
  protocols:
    - name: Magnet Link
      schemes:
        - magnet

win:
  icon: build/icon.ico
  target:
    - nsis
  artifactName: "ACCELARA-${arch}-${version}.${ext}"
  protocols:
    - name: Magnet Link
      schemes:
        - magnet

nsis:
  oneClick: false
  perMachine: false
  allowToChangeInstallationDirectory: true
  artifactName: "ACCELARA-Installer-${arch}-${version}.${ext}"

linux:
  icon: build/icon.png
  target:
    - AppImage
  artifactName: "ACCELARA-${arch}-${version}.${ext}"
  protocols:
    - name: Magnet Link
      schemes:
        - magnet

publish:
  provider: github
  owner: mwangiiharun
  repo: accelara
  releaseType: release
  channel: latest
  publishAutoUpdate: true

fileAssociations:
  - ext: torrent
    name: Torrent File
    description: BitTorrent file
    mimeType: application/x-bittorrent

afterPack: |
  const path = require("path");
  const fs = require("fs");

  module.exports = async function(context) {
    const binPath = path.join(context.appOutDir, "bin");
    if (fs.existsSync(binPath)) {
      const files = fs.readdirSync(binPath);
      for (const file of files) {
        try {
          fs.chmodSync(path.join(binPath, file), 0o755);
          console.log("Set executable permission for", file);
        } catch (err) {
          console.warn("Failed to chmod binary:", file, err);
        }
      }
    }
  };